import{e,o as t,c as n,w as a,h as i,a3 as r,a4 as o,B as l,C as s,a5 as u,a6 as f,u as c,a7 as h,J as d,r as g,l as p,f as m,F as v,g as b,a8 as S,a9 as I,i as P,A as y,D as x,aa as D,$ as C,a0 as w,Q as T,M as F,Z as O,G as E,H as k,Y as L,E as M,X as U,ab as R,ac as _,I as B,d as G,ad as N,b as A,a as $}from"./vendor.c6ff2267.js";import{u as z,a as V,_ as W,j as H}from"./index.0b9a866a.js";const Y=e({inheritAttrs:!1,__name:"FormSlider",props:{label:{default:""},labelPlacement:null},setup(e){const u=e;return(f,c)=>{const h=l,d=s;return t(),n(d,{label:u.label,labelPlacement:e.labelPlacement},{default:a((()=>[i(h,r(o(f.$attrs)),null,16)])),_:1},8,["label","labelPlacement"])}}}),X=e({inheritAttrs:!1,__name:"ColorPicker",props:{label:{default:""}},setup(e){const l=e;return(e,f)=>{const c=u,h=s;return t(),n(h,{label:l.label},{default:a((()=>[i(c,r(o(e.$attrs)),null,16)])),_:1},8,["label"])}}}),J=e({__name:"RatioSelector",props:{value:null},emits:["update:value"],setup(e,{emit:r}){const o=e,l=["1:1","4:3","3:4","3:2","2:3","16:9","9:16"],u=l.map((e=>({label:e,value:e})));function d(e){r("update:value",e)}return f((()=>o.value),(()=>{l.includes(o.value)||d(l[0])})),(e,r)=>{const l=h,f=s;return t(),n(f,{label:"图片比例"},{default:a((()=>[i(l,{value:o.value,options:c(u),"onUpdate:value":d},null,8,["value","options"])])),_:1})}}}),j=b("div",{style:{flex:"1"}},null,-1),q=b("div",{style:{flex:"1"}},null,-1),Q=e({__name:"BorderConfigEditor",props:{config:null},setup(e){const r=d(e,"config"),o=g(100),l=g(!0);function u(e){r.value.border.top=e,r.value.border.bottom=e,r.value.border.left=e,r.value.border.right=e}function h(e){e&&(r.value.border.top=o.value,r.value.border.bottom=o.value,r.value.border.left=o.value,r.value.border.right=o.value)}function b(){const{left:e=100,right:t=100,top:n=100,bottom:a=100}=r.value.border;e!==t||e!==n||e!==a?l.value=!1:(o.value=e,l.value=!0)}return f((()=>r.value),(()=>{b()})),p((()=>{b()})),(e,f)=>{const d=S,g=s;return t(),m(v,null,[i(g,{"label-placement":"left",label:"固定比例"},{default:a((()=>[j,i(d,{value:c(r).border.useFixedRatio,"onUpdate:value":f[0]||(f[0]=e=>c(r).border.useFixedRatio=e)},null,8,["value"])])),_:1}),c(r).border.useFixedRatio?(t(),m(v,{key:0},[i(J,{value:c(r).border.ratio,"onUpdate:value":f[1]||(f[1]=e=>c(r).border.ratio=e)},null,8,["value"]),i(Y,{value:c(r).border.photoSize,"onUpdate:value":f[2]||(f[2]=e=>c(r).border.photoSize=e),label:"大小",min:0,max:100},null,8,["value"])],64)):(t(),m(v,{key:1},[i(g,{"label-placement":"left",label:"等宽"},{default:a((()=>[q,i(d,{value:l.value,"onUpdate:value":f[3]||(f[3]=e=>l.value=e),onChange:h},null,8,["value"])])),_:1}),l.value?(t(),n(Y,{key:0,value:o.value,"onUpdate:value":[f[4]||(f[4]=e=>o.value=e),u],"label-placement":"left",min:0,max:200},null,8,["value"])):(t(),m(v,{key:1},[i(Y,{value:c(r).border.top,"onUpdate:value":f[5]||(f[5]=e=>c(r).border.top=e),"label-placement":"left",label:"上",min:0,max:200},null,8,["value"]),i(Y,{value:c(r).border.bottom,"onUpdate:value":f[6]||(f[6]=e=>c(r).border.bottom=e),"label-placement":"left",label:"下",min:0,max:200},null,8,["value"]),i(Y,{value:c(r).border.left,"onUpdate:value":f[7]||(f[7]=e=>c(r).border.left=e),"label-placement":"left",label:"左",min:0,max:200},null,8,["value"]),i(Y,{value:c(r).border.right,"onUpdate:value":f[8]||(f[8]=e=>c(r).border.right=e),"label-placement":"left",label:"右",min:0,max:200},null,8,["value"])],64))],64)),i(X,{label:"边框颜色",value:c(r).theme.background,"onUpdate:value":f[9]||(f[9]=e=>c(r).theme.background=e)},null,8,["value"])],64)}}});function K(){const e=g(null);return{filePicker:e,pick:function(){return new Promise(((t,n)=>{const a=e.value;if(!a)return n(new Error("filePicker is null!"));a.onchange=()=>{const e=a.files;if(!e)return n(new Error("no pick!"));t(e)},a.onerror=e=>{n(e)},a.click()}))}}}const Z=y(" 本地图片 "),ee=e({__name:"LogoSelector",props:{value:{default:""}},emits:["update:value"],setup(e,{emit:r}){const o=e,{filePicker:l,pick:u}=K(),m=d(z(),"logos"),v=g(0);p((()=>{w()})),f((()=>[o.value,m.value]),(()=>{w()}));const S=I((()=>m.value.map(((e,t)=>({label:e.label,value:t}))))),y=e=>{v.value=e,r("update:value",m.value[e].url)},C=I((()=>!(v.value<0)&&"other"===m.value[v.value].key)),w=()=>{const e=o.value,t=m.value[v.value];if(t&&t.url===e)return;let n=m.value.findIndex((t=>t.url===e&&"other"!==t.key));n<0&&(n=0,e&&(n=m.value.findIndex((e=>"other"===e.key)),n=n<0?0:n),m.value[n].url&&r("update:value",m.value[n].url)),v.value=n},T=()=>{u().then((e=>{const t=e[0];t&&r("update:value",t)}))};return(e,r)=>{const o=h,u=x,f=D,d=s;return t(),n(d,{label:"品牌"},{default:a((()=>[i(f,null,{default:a((()=>[i(o,{value:v.value,options:c(S),"onUpdate:value":y},null,8,["value","options"]),c(C)?(t(),n(u,{key:0,type:"primary",onClick:T},{default:a((()=>[b("input",{type:"file",ref_key:"filePicker",ref:l,hidden:""},null,512),Z])),_:1})):P("",!0)])),_:1})])),_:1})}}}),te=[{key:"photo by {artist}",label:"作者"},{key:"光圈:{F} 快门:{S} ISO:{ISO}",label:"曝光三要素"},{key:"F{F} {S}S ISO{ISO} {EV}EV",label:"曝光信息"},{key:"{focalLength}mm f/{F} {S} ISO{ISO}",label:"焦段与曝光"},{key:"{dateTime}",label:"时间"},{key:"{lensModel}",label:"镜头信息"},{key:"{make} {model}",label:"相机信息"}],ne=y("模板"),ae=e({inheritAttrs:!1,__name:"DescTextInput",props:{label:{default:""},value:{default:""}},emits:["update:value"],setup(e,{emit:r}){const o=e;function l(e){r("update:value",e.toString())}return(r,u)=>{const f=w,h=x,d=T,g=D,p=s;return t(),n(p,{label:o.label},{default:a((()=>[i(g,null,{default:a((()=>[i(f,C({value:e.value},r.$attrs,{"onUpdate:value":l}),null,16,["value"]),i(d,{trigger:"click",options:c(te),onSelect:l},{default:a((()=>[i(h,{type:"primary"},{default:a((()=>[ne])),_:1})])),_:1},8,["options"])])),_:1})])),_:1},8,["label"])}}}),ie=e({__name:"AlignSelector",props:{value:null},emits:["update:value"],setup(e,{emit:r}){const o=e,l=[{value:"left",label:"左边"},{value:"center",label:"居中"},{value:"right",label:"右边"}];function u(e){r("update:value",e)}return(e,r)=>{const f=h,c=s;return t(),n(c,{label:"位置"},{default:a((()=>[i(f,{value:o.value,options:l,"onUpdate:value":u},null,8,["value"])])),_:1})}}}),re=[{value:"sans-serif",label:"默认"},{value:"serif",label:"衬线字体"},{value:"Helvetica",label:"Helvetica"},{value:"Georgia",label:"Georgia"},{value:"Tahoma",label:"Tahoma"},{value:"Time News Roman",label:"Time News Roman"},{value:"Impact",label:"Impact"},{value:"Verdana",label:"Verdana"},{value:"Trebuchet MS",label:"Trebuchet MS"},{value:"微软雅黑",label:"微软雅黑"},{value:"宋体",label:"宋体"},{value:"Courier New",label:"Courier New"},{value:"Hei",label:"Hei"},{value:"Monaco",label:"Monaco"},{value:"simhei",label:"simhei"}];function oe(e){return new Promise((t=>{const n=new FileReader;n.onload=()=>{n.result instanceof ArrayBuffer?t(n.result):t(new ArrayBuffer(0))},n.readAsArrayBuffer(e)}))}const le=y(" 本地字体 "),se=e({__name:"FontFamilySelector",props:{value:null},emits:["update:value"],setup(e,{emit:r}){const o=e,{startLoading:l,stopLoading:u}=V(),d=F(),{filePicker:m,pick:v}=K(),S=g(0);p((()=>{w()})),f((()=>[o.value]),(()=>{w()}));const y=I((()=>re.map(((e,t)=>({value:t,label:e.label}))).concat([{label:"自定义",value:-1}])));function C(e){S.value=e;const t=re[e];t&&r("update:value",t.value)}function w(){const e=o.value,t=re[S.value];if(t&&t.value===e)return;const n=re.findIndex((t=>t.value===e));S.value=n<0?-1:n}function T(){v().then((e=>{const t=e[0];t&&(l("加载字体"),oe(t).then((e=>async function(e,t){const n=new FontFace(e,t);return await n.load(),document.fonts.add(n),n}(t.name,e))).then((()=>{r("update:value",t.name),d.success("加载字体成功")})).catch((()=>{d.error("加载字体成功")})).finally((()=>{u()})))}))}return(e,r)=>{const o=h,l=x,u=D,f=s;return t(),n(f,{label:"字体"},{default:a((()=>[i(u,null,{default:a((()=>[i(o,{options:c(y),value:S.value,"onUpdate:value":C},null,8,["options","value"]),S.value<0?(t(),n(l,{key:0,type:"primary",onClick:T},{default:a((()=>[b("input",{type:"file",ref_key:"filePicker",ref:m,hidden:""},null,512),le])),_:1})):P("",!0)])),_:1})])),_:1})}}}),ue=e({__name:"LogoCongfigEditor",props:{config:null},setup(e){const n=d(e,"config");return(e,a)=>(t(),m(v,null,[i(ee,{value:c(n).logo,"onUpdate:value":a[0]||(a[0]=e=>c(n).logo=e)},null,8,["value"]),i(ae,{label:"文字说明",placeholder:"文字说明",value:c(n).text.text,"onUpdate:value":a[1]||(a[1]=e=>c(n).text.text=e)},null,8,["value"]),i(X,{label:"文字颜色",value:c(n).text.color,"onUpdate:value":a[2]||(a[2]=e=>c(n).text.color=e)},null,8,["value"]),i(se,{value:c(n).text.fontFamily,"onUpdate:value":a[3]||(a[3]=e=>c(n).text.fontFamily=e)},null,8,["value"]),i(ie,{value:c(n).align,"onUpdate:value":a[4]||(a[4]=e=>c(n).align=e)},null,8,["value"]),i(Y,{value:c(n).contentSize,"onUpdate:value":a[5]||(a[5]=e=>c(n).contentSize=e),label:"内容大小"},null,8,["value"])],64))}}),fe=(e=>(E("data-v-ef4e3204"),e=e(),k(),e))((()=>b("div",{style:{"flex-grow":"1"}},null,-1))),ce=W(e({__name:"ShadowContent",props:{item:null},setup(e){const r=d(e,"item");return(e,o)=>{const l=S,u=s;return t(),n(u,{class:"item-wrapper","label-placement":"left",label:c(r).name},{default:a((()=>[fe,i(l,{value:c(r).enable,"onUpdate:value":o[0]||(o[0]=e=>c(r).enable=e),onClick:o[1]||(o[1]=O((()=>{}),["stop"]))},null,8,["value"])])),_:1},8,["label"])}}}),[["__scopeId","data-v-ef4e3204"]]);function he(e="阴影",t=!0){return{name:e,color:"#000000cc",blur:100,offsetX:0,offsetY:0,enable:t,inner:!1}}const de=b("span",{style:{width:"10px"}},null,-1),ge={style:{width:"100%"}},pe=e({__name:"ShadowEditor",props:{item:null},setup(e){const n=d(e,"item");return(e,r)=>{const o=w,l=S,f=s,h=u;return t(),m(v,null,[i(f,{label:"名称"},{default:a((()=>[i(o,{value:c(n).name,"onUpdate:value":r[0]||(r[0]=e=>c(n).name=e)},null,8,["value"]),de,i(l,{value:c(n).enable,"onUpdate:value":r[1]||(r[1]=e=>c(n).enable=e)},null,8,["value"])])),_:1}),i(Y,{label:"强度",value:c(n).blur,"onUpdate:value":r[2]||(r[2]=e=>c(n).blur=e)},null,8,["value"]),i(f,{label:"颜色"},{default:a((()=>[i(h,{value:c(n).color,"onUpdate:value":r[3]||(r[3]=e=>c(n).color=e)},null,8,["value"])])),_:1}),i(f,{label:"偏移量"},{default:a((()=>[b("div",ge,[i(Y,{label:"x",min:-100,max:100,"label-placement":"left",value:c(n).offsetX,"onUpdate:value":r[4]||(r[4]=e=>c(n).offsetX=e)},null,8,["value"]),i(Y,{label:"y",min:-100,max:100,"label-placement":"left",value:c(n).offsetY,"onUpdate:value":r[5]||(r[5]=e=>c(n).offsetY=e)},null,8,["value"])])])),_:1})],64)}}}),me=y("删除"),ve=y("确认"),be=W(e({inheritAttrs:!1,__name:"EditDialog",props:{item:null},emits:["delete","back"],setup(e,{emit:r}){const o=e,l=L(),s=d(o,"item");function u(){l.warning({title:"提示",content:`是否删除阴影 ${s.value.name}`,negativeText:"取消",positiveText:"删除",positiveButtonProps:{type:"primary"},onPositiveClick:()=>{r("delete")}})}function f(){r("back")}return(e,r)=>{const o=x,l=M;return t(),n(l,C({class:"app-info",preset:"dialog",title:"阴影编辑"},e.$attrs),{action:a((()=>[i(o,{onClick:u},{default:a((()=>[me])),_:1}),i(o,{type:"primary",onClick:f},{default:a((()=>[ve])),_:1})])),default:a((()=>[i(pe,{item:c(s)},null,8,["item"])])),_:1},16)}}}),[["__scopeId","data-v-eac363b4"]]),Se={class:"shadow-wrapper"},Ie=y("添加阴影"),Pe=W(e({__name:"ShadowList",props:{list:null,labelPlacement:null},emits:["update:list"],setup(e,{emit:r}){const o=e,l=g(0);function u(){const e=he("阴影"+ ++l.value);r("update:list",o.list.concat([e]))}const f=g(!1),c=g(-1),h=g(he());function d(){const e=[...o.list];e.splice(c.value,1),r("update:list",e),f.value=!1}function p(){f.value=!1}return(r,l)=>{const g=x,S=s;return t(),m(v,null,[i(S,{label:"阴影",labelPlacement:e.labelPlacement},{default:a((()=>[b("div",Se,[(t(!0),m(v,null,U(o.list,((e,a)=>(t(),n(ce,{item:e,key:a,onClick:e=>function(e){c.value=e,h.value=o.list[e],f.value=!0}(a)},null,8,["item","onClick"])))),128)),i(g,{type:"primary",block:"",onClick:u},{default:a((()=>[Ie])),_:1})])])),_:1},8,["labelPlacement"]),i(be,{show:f.value,"onUpdate:show":l[0]||(l[0]=e=>f.value=e),item:h.value,onDelete:d,onBack:p},null,8,["show","item"])],64)}}}),[["__scopeId","data-v-3bf39dd3"]]),ye=e({__name:"MainImageConfigEditor",props:{config:null},setup(e){const n=d(e,"config");return(e,a)=>(t(),m(v,null,[i(Y,{label:"圆角",value:c(n).radius,"onUpdate:value":a[0]||(a[0]=e=>c(n).radius=e)},null,8,["value"]),i(Pe,{list:c(n).shadows,"onUpdate:list":a[1]||(a[1]=e=>c(n).shadows=e)},null,8,["list"])],64))}}),xe={class:"config-editor"},De=W(e({__name:"ConfigEditor",props:{config:null},setup(e){const n=e;return(e,r)=>{const o=R,l=_;return t(),m("div",xe,[i(l,{"default-expanded-names":"logo"},{default:a((()=>[i(o,{title:"logo",name:"logo"},{default:a((()=>[i(ue,{config:n.config},null,8,["config"])])),_:1}),i(o,{title:"边框",name:"border"},{default:a((()=>[i(Q,{config:n.config},null,8,["config"])])),_:1}),i(o,{title:"主图处理",name:"image"},{default:a((()=>[i(ye,{config:n.config},null,8,["config"])])),_:1})])),_:1})])}}}),[["__scopeId","data-v-706917db"]]);function Ce(e,t){return"string"!=typeof e||0===(e=e.split("").map((e=>e.charCodeAt(0)<33?" ":e)).join("").trim()).length?t:e}var we,Te,Fe,Oe={exports:{}};const Ee=Oe.exports=(we="minute",Te=/[+-]\d\d(?::?\d\d)?/g,Fe=/([+-]|\d\d)/g,function(e,t,n){var a=t.prototype;n.utc=function(e){return new t({date:e,utc:!0,args:arguments})},a.utc=function(e){var t=n(this.toDate(),{locale:this.$L,utc:!0});return e?t.add(this.utcOffset(),we):t},a.local=function(){return n(this.toDate(),{locale:this.$L,utc:!1})};var i=a.parse;a.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),i.call(this,e)};var r=a.init;a.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else r.call(this)};var o=a.utcOffset;a.utcOffset=function(e,t){var n=this.$utils().u;if(n(e))return this.$u?0:n(this.$offset)?o.call(this):this.$offset;if("string"==typeof e&&null===(e=function(e){void 0===e&&(e="");var t=e.match(Te);if(!t)return null;var n=(""+t[0]).match(Fe)||["-",0,0],a=n[0],i=60*+n[1]+ +n[2];return 0===i?0:"+"===a?i:-i}(e)))return this;var a=Math.abs(e)<=16?60*e:e,i=this;if(t)return i.$offset=a,i.$u=0===e,i;if(0!==e){var r=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(i=this.local().add(a+r,we)).$offset=a,i.$x.$localOffset=r}else i=this.utc();return i};var l=a.format;a.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return l.call(this,t)},a.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},a.isUTC=function(){return!!this.$u},a.toISOString=function(){return this.toDate().toISOString()},a.toString=function(){return this.toDate().toUTCString()};var s=a.toDate;a.toDate=function(e){return"s"===e&&this.$offset?n(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():s.call(this)};var u=a.diff;a.diff=function(e,t,a){if(e&&this.$u===e.$u)return u.call(this,e,t,a);var i=this.local(),r=n(e).local();return u.call(i,r,t,a)}});function ke(e,t){if(t=t&&t.trim(),!e)return t;const n=function(e){return{artist:Ce(e.Artist),F:e.FNumber&&e.FNumber+"",S:Le(e.ExposureTime),ISO:e.ISO,EV:Me(e.ExposureCompensation),lensMake:Ce(e.LensMake),lensModel:Ce(e.LensModel),make:Ce(e.Make),model:Ce(e.Model),dateTime:Re(e),focalLength:Ue(e)}}(e);return t.replace(/\{\w+\}/g,(e=>{const t=e.slice(1,e.length-1);return["string","number"].includes(typeof n[t])?n[t]:e}))}function Le(e){if(!e)return;if(e>1)return Me(e);return`1/${Math.floor(1/e)}`}function Me(e){if(!e&&"number"!=typeof e)return;let t=e.toFixed(1);return t.endsWith(".0")&&(t=t.slice(0,t.length-2)),t}function Ue(e){const t=e.FocalLengthIn35mmFormat||e.FocalLength;return t&&t+""}function Re(e){const t=e.DateTimeOriginal||e.CreateDate||e.ModifyDate;if(t)return G.extend(Ee),G.utc(1e3*t).format("YYYY-MM-DD HH:mm:ss")}function _e(e,t,n,a){const i=ke(a,e.text.text);return{...e,logo:n,image:t,text:{...e.text,text:i}}}function Be(e,t){return(e>t?t:e)/5}function Ge(e=""){const t=parseInt(e||"");return Number.isNaN(t)||0===t?1:t}function Ne(e){const t=function(e,t){if(!e)return{width:0,height:0,padding:{left:0,right:0,top:0,bottom:0}};t=function(e){let t=e.useFixedRatio,n=e.ratio,a=e.photoSize;return"boolean"!=typeof t&&(t=!1),"string"!=typeof n&&(n="1:1"),("number"!=typeof a||a<0)&&(a=0),{...e,useFixedRatio:t,ratio:n,photoSize:a}}(t);let{left:n=0,right:a=0,top:i=0,bottom:r=0}=t;const{useFixedRatio:o=!1,ratio:l="1:1",photoSize:s=0}=t,{width:u,height:f}=e;if(o){const[t,o]=l.split(":"),c=Ge(t),h=Ge(o),{height:d,width:g}=function(e,t,n){const{width:a,height:i}=e;let r=a,o=a/t;o<i&&(o=i,r=i*t);const l=1+n/100;return o*=l,r*=l,{width:r,height:o}}(e,c/h,s);n=(g-u)/2,a=n,i=(d-f)/2,r=i}else{const e=Be(u,f)/100;n*=e,a*=e,i*=e,r*=e}return{width:u+n+a,height:f+i+r,padding:{left:n,right:a,top:i,bottom:r}}}(e.image,e.border),n=function(e,t){const{padding:n}=t;let{contentSize:a}=e;const{left:i=0,right:r=0,bottom:o=0}=n;a/=100;let l=o*a;const s=l/3,u=l/5,f=.1*l;l-=(l-s-u-f)/2*2;const c=(o-l)/2,h=t.width-i-r;return{height:l,width:h,top:c,bottom:c,left:0,right:0,gap:f,fontSize:u,logoHeight:s}}(e,t),{background:a}=e.theme;let i=0;return e.logo&&(i|=1),e.text.text&&(i|=2),{...e,...t,...ze(e,n,i),background:a,contentInfo:n,radius:Ae(e),logoInfo:$e(e,n,i)}}function Ae(e){const{image:t,radius:n}=e;if(!t)return 0;const{width:a,height:i}=t;return(a>i?i:a)/2*(n/100)}function $e(e,t,n){const{logo:a,align:i}=e;if(!a)return;const{height:r,width:o}=t;let l=t.logoHeight,s=l/a.height,u=0,f=0;switch(1===n&&(l=r,s=l/a.height,f=r/2-l/2),i){case"left":u=0;break;case"center":u=o/2-a.width*s/2;break;case"right":u=o-a.width*s}return{left:u,top:f,scale:s}}function ze(e,t,n){const{align:a}=e,{width:i}=t;let r=t.fontSize,o=0,l=0;switch(2===n?(r=t.height/2,o=(t.height-r)/2):o=t.height-r,a){case"left":l=0;break;case"center":l=i/2;break;case"right":l=i}return{text:{...e.text,align:e.align,isBold:!1,size:r,color:e.text.color,padding:{top:o,left:l}}}}function Ve(e,t){switch(e){case 1:return t.nextUInt8();case 3:case 8:return t.nextUInt16();case 4:case 9:return t.nextUInt32();case 5:return[t.nextUInt32(),t.nextUInt32()];case 6:return t.nextInt8();case 10:return[t.nextInt32(),t.nextInt32()];case 11:return t.nextFloat();case 12:return t.nextDouble();default:throw new Error("Invalid format while decoding: "+e)}}function We(e,t){var n,a,i=t.nextUInt16(),r=t.nextUInt16(),o=function(e){switch(e){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}(r),l=t.nextUInt32(),s=o*l;if(s>4&&(t=e.openWithOffset(t.nextUInt32())),2===r){var u=(n=t.nextString(l)).indexOf("\0");-1!==u&&(n=n.substr(0,u))}else if(7===r)n=t.nextBuffer(l);else if(0!==r)for(n=[],a=0;a<l;++a)n.push(Ve(r,t));return s<4&&t.skip(4-s),[i,n,r]}function He(e,t,n){var a,i,r=t.nextUInt16();for(i=0;i<r;++i)n((a=We(e,t))[0],a[1],a[2])}var Ye={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(e,t){var n,a,i,r;try{n=function(e){if("Exif\0\0"!==e.nextString(6))throw new Error("Invalid EXIF header");var t=e.mark(),n=e.nextUInt16();if(18761===n)e.setBigEndian(!1);else{if(19789!==n)throw new Error("Invalid TIFF header");e.setBigEndian(!0)}if(42!==e.nextUInt16())throw new Error("Invalid TIFF data");return t}(e)}catch(Fe){return!1}var o=n.openWithOffset(e.nextUInt32()),l=this.IFD0;He(n,o,(function(e,n,r){switch(e){case 34853:i=n[0];break;case 34665:a=n[0];break;default:t(l,e,n,r)}}));var s=o.nextUInt32();if(0!==s){var u=n.openWithOffset(s);He(n,u,t.bind(null,this.IFD1))}if(i){var f=n.openWithOffset(i);He(n,f,t.bind(null,this.GPSIFD))}if(a){var c=n.openWithOffset(a),h=this.InteropIFD;He(n,c,(function(e,n,a){40965===e?r=n[0]:t(h,e,n,a)}))}if(r){var d=n.openWithOffset(r);He(n,d,t.bind(null,this.InteropIFD))}return!0}};function Xe(e){return parseInt(e,10)}function Je(e,t){e=e.map(Xe),t=t.map(Xe);var n=e[0],a=e[1]-1,i=e[2],r=t[0],o=t[1],l=t[2];return Date.UTC(n,a,i,r,o,l,0)/1e3}function je(e){var t=e.substr(0,10).split("-"),n=e.substr(11,8).split(":"),a=e.substr(19,6).split(":").map(Xe),i=3600*a[0]+60*a[1],r=Je(t,n);if("number"==typeof(r-=i)&&!isNaN(r))return r}function qe(e){var t=e.split(" "),n=Je(t[0].split(":"),t[1].split(":"));if("number"==typeof n&&!isNaN(n))return n}var Qe,Ke,Ze={parseDateWithSpecFormat:qe,parseDateWithTimezoneFormat:je,parseExifDate:function(e){var t=19===e.length&&":"===e.charAt(4);return 25===e.length&&"T"===e.charAt(10)?je(e):t?qe(e):void 0}},et=[{section:Ye.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:Ye.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],tt=[{section:Ye.SubIFD,type:306,name:"ModifyDate"},{section:Ye.SubIFD,type:36867,name:"DateTimeOriginal"},{section:Ye.SubIFD,type:36868,name:"CreateDate"},{section:Ye.SubIFD,type:306,name:"ModifyDate"}],nt={castDegreeValues:function(e,t){et.forEach((function(n){var a=e(n);if(a){var i=e({section:n.section,type:n.refType,name:n.refName})===n.posVal?1:-1,r=(a[0]+a[1]/60+a[2]/3600)*i;t(n,r)}}))},castDateValues:function(e,t){tt.forEach((function(n){var a=e(n);if(a){var i=Ze.parseExifDate(a);void 0!==i&&t(n,i)}}))},simplifyValue:function(e,t){return Array.isArray(e)&&1===(e=e.map((function(e){return 10===t||5===t?e[0]/e[1]:e}))).length&&(e=e[0]),e}};var at,it,rt,ot,lt={parseSections:function(e,t){var n,a;for(e.setBigEndian(!0);e.remainingLength()>0&&218!==a;){if(255!==e.nextUInt8())throw new Error("Invalid JPEG section offset");n=(a=e.nextUInt8())>=208&&a<=217||218===a?0:e.nextUInt16()-2,t(a,e.branch(0,n)),e.skip(n)}},getSizeFromSOFSection:function(e){return e.skip(1),{height:e.nextUInt16(),width:e.nextUInt16()}},getSectionName:function(e){var t,n;switch(e){case 216:t="SOI";break;case 196:t="DHT";break;case 219:t="DQT";break;case 221:t="DRI";break;case 218:t="SOS";break;case 254:t="COM";break;case 217:t="EOI";break;default:e>=224&&e<=239?(t="APP",n=e-224):e>=192&&e<=207&&196!==e&&200!==e&&204!==e?(t="SOF",n=e-192):e>=208&&e<=215&&(t="RST",n=e-208)}var a={name:t};return"number"==typeof n&&(a.index=n),a}},st=Ye,ut=nt;function ft(e,t,n,a,i,r,o){this.startMarker=e,this.tags=t,this.imageSize=n,this.thumbnailOffset=a,this.thumbnailLength=i,this.thumbnailType=r,this.app1Offset=o}function ct(e){this.stream=e,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}ft.prototype={hasThumbnail:function(e){return!(!this.thumbnailOffset||!this.thumbnailLength)&&("string"!=typeof e||("image/jpeg"===e.toLowerCase().trim()?6===this.thumbnailType:"image/tiff"===e.toLowerCase().trim()&&1===this.thumbnailType))},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var e,t=this._getThumbnailStream();return lt.parseSections(t,(function(t,n){"SOF"===lt.getSectionName(t).name&&(e=lt.getSizeFromSOFSection(n))})),e}},ct.prototype={enableBinaryFields:function(e){return this.flags.readBinaryTags=!!e,this},enablePointers:function(e){return this.flags.hidePointers=!e,this},enableTagNames:function(e){return this.flags.resolveTagNames=!!e,this},enableImageSize:function(e){return this.flags.imageSize=!!e,this},enableReturnTags:function(e){return this.flags.returnTags=!!e,this},enableSimpleValues:function(e){return this.flags.simplifyValues=!!e,this},parse:function(){var e,t,n,a,i,r,o,l,s,u=this.stream.mark(),f=u.openWithOffset(0),c=this.flags;return c.resolveTagNames&&(o=Ke?Qe:(Ke=1,Qe={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}})),c.resolveTagNames?(e={},l=function(t){return e[t.name]},s=function(t,n){e[t.name]=n}):(e=[],l=function(t){var n;for(n=0;n<e.length;++n)if(e[n].type===t.type&&e[n].section===t.section)return e.value},s=function(t,n){var a;for(a=0;a<e.length;++a)if(e[a].type===t.type&&e[a].section===t.section)return void(e.value=n)}),lt.parseSections(f,(function(l,s){var f=s.offsetFrom(u);225===l?st.parseTags(s,(function(t,r,l,s){if(c.readBinaryTags||7!==s){if(513===r){if(n=l[0],c.hidePointers)return}else if(514===r){if(a=l[0],c.hidePointers)return}else if(259===r&&(i=l[0],c.hidePointers))return;if(c.returnTags)if(c.simplifyValues&&(l=ut.simplifyValue(l,s)),c.resolveTagNames){var u=(t===st.GPSIFD?o.gps:o.exif)[r];u||(u=o.exif[r]),e.hasOwnProperty(u)||(e[u]=l)}else e.push({section:t,type:r,value:l})}}))&&(r=f):c.imageSize&&"SOF"===lt.getSectionName(l).name&&(t=lt.getSizeFromSOFSection(s))})),c.simplifyValues&&(ut.castDegreeValues(l,s),ut.castDateValues(l,s)),new ft(u,e,t,n,a,i,r)}};var ht=ct;var dt=function(e,t){if(e instanceof(t=t||(0,eval)("this")).ArrayBuffer){var n=function(){if(it)return at;function e(e,t,n,a,i,r){this.global=i,t=t||0,n=n||e.byteLength-t,this.arrayBuffer=e.slice(t,t+n),this.view=new i.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(a),this.offset=0,this.parentOffset=(r||0)+t}return it=1,e.prototype={setBigEndian:function(e){this.littleEndian=!e},nextUInt8:function(){var e=this.view.getUint8(this.offset);return this.offset+=1,e},nextInt8:function(){var e=this.view.getInt8(this.offset);return this.offset+=1,e},nextUInt16:function(){var e=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},nextUInt32:function(){var e=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},nextInt16:function(){var e=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},nextInt32:function(){var e=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},nextFloat:function(){var e=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},nextDouble:function(){var e=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},nextBuffer:function(e){var t=this.arrayBuffer.slice(this.offset,this.offset+e);return this.offset+=e,t},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(e){var t=this.arrayBuffer.slice(this.offset,this.offset+e);return t=String.fromCharCode.apply(null,new this.global.Uint8Array(t)),this.offset+=e,t},mark:function(){var t=this;return{openWithOffset:function(n){return n=(n||0)+this.offset,new e(t.arrayBuffer,n,t.arrayBuffer.byteLength-n,!t.littleEndian,t.global,t.parentOffset)},offset:this.offset,getParentOffset:function(){return t.parentOffset}}},offsetFrom:function(e){return this.parentOffset+this.offset-(e.offset+e.getParentOffset())},skip:function(e){this.offset+=e},branch:function(t,n){return n="number"==typeof n?n:this.arrayBuffer.byteLength-(this.offset+t),new e(this.arrayBuffer,this.offset+t,n,!this.littleEndian,this.global,this.parentOffset)}},at=e}();return new ht(new n(e,0,e.byteLength,!0,t))}var a=function(){if(ot)return rt;function e(e,t,n,a){this.buffer=e,this.offset=t||0,n="number"==typeof n?n:e.length,this.endPosition=this.offset+n,this.setBigEndian(a)}return ot=1,e.prototype={setBigEndian:function(e){this.bigEndian=!!e},nextUInt8:function(){var e=this.buffer.readUInt8(this.offset);return this.offset+=1,e},nextInt8:function(){var e=this.buffer.readInt8(this.offset);return this.offset+=1,e},nextUInt16:function(){var e=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,e},nextUInt32:function(){var e=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,e},nextInt16:function(){var e=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,e},nextInt32:function(){var e=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,e},nextFloat:function(){var e=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,e},nextDouble:function(){var e=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,e},nextBuffer:function(e){var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},remainingLength:function(){return this.endPosition-this.offset},nextString:function(e){var t=this.buffer.toString("utf8",this.offset,this.offset+e);return this.offset+=e,t},mark:function(){var t=this;return{openWithOffset:function(n){return n=(n||0)+this.offset,new e(t.buffer,n,t.endPosition-n,t.bigEndian)},offset:this.offset}},offsetFrom:function(e){return this.offset-e.offset},skip:function(e){this.offset+=e},branch:function(t,n){return n="number"==typeof n?n:this.endPosition-(this.offset+t),new e(this.buffer,this.offset+t,n,this.bigEndian)}},rt=e}();return new ht(new a(e,0,e.length,!0))};function gt(e){return dt(e).parse()}function pt(e){return new Promise((t=>{const{image:n}=e;var a;n?"string"==typeof n?fetch(n).then((e=>e.arrayBuffer())).then((e=>{const n=gt(e);t(n.tags)})).catch((()=>{t(void 0)})):(a=n,oe(a).then((e=>gt(e)))).then((e=>{t(e.tags)})).catch((()=>{t(void 0)})):t(void 0)}))}function mt(e){return new Promise(((t,n)=>{const a=new Image;a.onload=()=>{t(a)},a.onerror=e=>{n(e)},a.src=e}))}function vt(e){return mt("string"==typeof e?e:URL.createObjectURL(e))}const bt=new WeakMap,St=new Map;function It(e){return"string"==typeof e?function(e){return new Promise(((t,n)=>{if(St.has(e)){const n=St.get(e);n&&t(n)}else mt(e).then((n=>{St.set(e,n),t(n)})).catch((e=>{n(e)}))}))}(e):function(e){return new Promise(((t,n)=>{if(bt.has(e)){const n=bt.get(e);n&&t(n)}else vt(e).then((n=>{bt.set(e,n),t(n)})).catch((e=>{n(e)}))}))}(e)}function Pt(e,t,n){return new Promise((a=>{let i=e.logo;"auto"===i&&(i=function(){var e;let a=t&&t.Make;if(!a)return"";a=null==(e=Ce(a,""))?void 0:e.toLowerCase();const i=n.find((e=>e.key===a));return i?i.url:""}()),i?It(i).then((e=>{a(e)})).catch((()=>{a(null)})):a(null)}))}function yt(e){return vt(e.image).catch((()=>null))}function xt(e){const t=N(),{exifData:n}=function(e){const t=g();function n(){pt(e.value).then((e=>{t.value=e}))}return f((()=>e.value.image),(()=>{n()})),p((()=>{n()})),{exifData:t}}(e),{mainImage:a}=function(e){const t=g(null);function n(){yt(e.value).then((e=>{t.value=e}))}return f((()=>e.value.image),(()=>{n()})),p((()=>{n()})),{mainImage:t}}(e),{logoImage:i}=function(e,t){const n=g(null),a=z();function i(){Pt(e.value,t.value,a.logos).then((e=>{n.value=e}))}return f((()=>[e.value.logo,e.value.image,t.value,a.logos]),(()=>{i()})),p((()=>{i()})),{logoImage:n}}(e,n);function r(){const r=_e(e.value,a.value,i.value,n.value);t.value=Ne(r)}return f((()=>[n.value,a.value,i.value,e.value]),(()=>{r()}),{deep:!0}),p((()=>{r()})),{renderInfo:t}}function Dt(e,t){const{width:n=0,height:a=0}=e,{width:i=0,height:r=0}=t;if(0===i||0===r)return{scale:1,width:n,height:a,x:0,y:0};let o=0,l=0;const s=n/i,u=a/r,f=s>u?u:s,c=i*f,h=r*f;return s>u?o=(n-c)/2:l=(a-h)/2,{scale:f,width:c,height:h,x:o,y:l}}function Ct(e,t){const n=e.getContext("2d");if(!n)return;const{x:a,y:i,scale:r}=Dt(e,t);n.clearRect(0,0,e.width,e.height),n.save(),n.translate(a,i),n.scale(r,r),0!==t.width&&0!==t.height||(t={...t,width:e.width,height:e.height}),function(e,t){Tt(e,(()=>{e.fillStyle=t.background,e.fillRect(0,0,t.width,t.height)}))}(n,t),function(e,t){const{padding:n,image:a}=t;if(!a)return;const i=document.createElement("canvas"),r=Dt({width:2048,height:2048},t);i.height=r.height,i.width=r.width;const o=i.getContext("2d");if(!o)return;const l=r.scale,{left:s=0,top:u=0}=n;o.translate(s*l,u*l);const f=a.width*l,c=a.height*l,h=t.radius*l;(function(e,t,n,a,i){const{shadows:r}=i,o=Be(t,n);r.filter((e=>e.enable&&!e.inner)).forEach((i=>{console.log(t,n),wt(e,t,n,a),e.shadowColor=i.color,e.shadowBlur=i.blur/100*200,e.shadowOffsetX=i.offsetX/100*o,e.shadowOffsetY=i.offsetY/100*o,e.fillStyle=i.color,e.fill()}))})(o,f,c,h,t),Tt(e,(()=>{e.drawImage(i,0,0,t.width,t.height)}))}(n,t),function(e,t){Tt(e,(()=>{const{padding:n,image:a}=t;if(!a)return;const{left:i=0,top:r=0}=n;e.translate(i,r),wt(e,a.width,a.height,t.radius),e.clip(),e.drawImage(a,0,0,a.width,a.height)}))}(n,t),function(e,t){Tt(e,(()=>{const{padding:n,contentInfo:a}=t,{left:i=0,bottom:r=0}=n;e.translate(i+a.left,t.height-r+a.top),function(e,t){(function(e,t){const{logo:n,logoInfo:a}=t;if(!n||!a)return;Tt(e,(()=>{const{left:t,top:i,scale:r}=a;e.translate(t,i),e.scale(r,r),e.drawImage(n,0,0,n.width,n.height)}))})(e,t),function(e,t){const{text:n}=t;!function(e,t){const{padding:n={},fontFamily:a}=t,{left:i=0,top:r=0}=n;let o;Tt(e,(()=>{e.translate(i,r);const{text:n,color:l="",size:s=0,align:u="center",isBold:f=!1,baseline:c="top"}=t;e.fillStyle=l,e.font=`${f?"bold":""} ${s}px ${function(e){if(!e)return"sans-serif";if(/\W/.test(e))return`"${e}"`}(a)}`,e.textBaseline=c||"top",e.textAlign=u||"center",e.fillText(n,0,0),o=e.measureText(n)}))}(e,n)}(e,t)}(e,{...t,width:a.width,height:a.width})}))}(n,t),n.restore()}function wt(e,t,n,a){e.beginPath(),e.moveTo(a,0),e.arcTo(t,0,t,a,a),e.arcTo(t,n,t-a,n,a),e.arcTo(0,n,0,n-a,a),e.arcTo(0,0,a,0,a),e.closePath()}function Tt(e,t){e.save(),t(),e.restore()}const Ft={class:"image-render"},Ot=W(e({__name:"ImageRender",props:{config:null},setup(e){const n=d(e,"config"),a=g(),{renderInfo:i}=xt(n);function r(){a.value&&i.value&&Ct(a.value,i.value)}return f((()=>i.value),(()=>{r()})),p((()=>{r()})),(e,n)=>(t(),m("div",Ft,[b("canvas",{ref_key:"canvas",ref:a,class:"canvas",height:"1024",width:"1024"},null,512)]))}}),[["__scopeId","data-v-00ed089b"]]),Et={class:"page-base"},kt={class:"control-area"},Lt={class:"control-body"},Mt={class:"footer"},Ut=W(e({__name:"PageBase",props:{frameConfig:null},setup(e){const n=d(e,"frameConfig");return(e,a)=>(t(),m("div",Et,[i(Ot,{config:c(n)},null,8,["config"]),b("div",kt,[A(e.$slots,"top-btn",{},void 0,!0),b("div",Lt,[i(De,{config:c(n)},null,8,["config"])]),b("div",Mt,[A(e.$slots,"footer",{},void 0,!0)])])]))}}),[["__scopeId","data-v-ef068b69"]]);function Rt(e=""){return{image:e,logo:"auto",contentSize:100,text:{text:"",color:"#353535",fontFamily:"sans-serif"},theme:{primaryColor:"#000000",secondaryColor:"#7e7e7c",background:"#ffffff"},border:{left:100,right:100,top:100,bottom:100,useFixedRatio:!1,ratio:"1:1",photoSize:0},radius:0,shadows:[],align:"center"}}function _t(){const e=g(Rt(H("/logo/logo-frame/","/images/logo.jpg")));return{frameConfig:e,resetConfig:()=>{e.value=Rt(e.value.image)}}}function Bt(e="",t=0){return{id:t,name:e,template:Rt()}}function Gt(e,t=""){return{...e,template:{...e.template,image:t}}}const Nt=$("templateList",(()=>{const e=g([]);function t(t){e.value.push(JSON.parse(JSON.stringify(Gt(t)))),n()}function n(){var t;t=e.value,localStorage.setItem("logoFrameWeb__templateList",JSON.stringify(t))}return p((()=>{e.value=function(){const e=localStorage.getItem("logoFrameWeb__templateList");if(!e)return[];try{const t=JSON.parse(e);return t&&Array.isArray(t)?t:[]}catch(Fe){return[]}}()})),{templateList:e,deleteByIndex:function(t){t<0||t>=e.value.length||(e.value.splice(t,1),n())},getOrCreateByIndex:function(t){const n=e.value[t];return n?JSON.parse(JSON.stringify(Gt(n,H("/logo/logo-frame/","/images/logo.jpg")))):Bt()},updateOrPushByIndex:function(a,i){e.value[a]?(e.value[a]=JSON.parse(JSON.stringify(Gt(i))),n()):t(i)},push:t}}));export{Ut as P,Pt as a,_e as b,yt as c,Ne as d,Bt as e,Nt as f,_t as g,pt as p,Ct as r,K as u};
